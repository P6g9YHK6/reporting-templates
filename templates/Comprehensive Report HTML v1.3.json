{
  "base_template": {
    "name": "Bootstrap Base_pqpjzi",
    "html": "<!doctype html>\n<html lang=\"en\">\n    <head>\n        <style>\n            {{css}}\n        </style>\n        <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC\" crossorigin=\"anonymous\">\n    </head>\n    <body>\n        {% block content %}{% endblock %}\n        {% block header %}{% endblock %}\n    </body>\n</html>"
  },
  "template": {
    "name": "Comprehensive Report HTML v1.3",
    "template_css": ".content-wrapper {\r\n        margin-left: 20px;  /* Adjust the margin as needed */\r\n        margin-right: 20px; /* Adjust the margin as needed */\r\n    }\r\ntable {\r\n    width: 100%;\r\n    border-collapse: collapse;\r\n}\r\nth, td {\r\n    border: 1px solid #ddd;\r\n    padding: 8px;\r\n}\r\nth {\r\n    background-color: #f2f2f2;\r\n    text-align: left;\r\n}\r\ntr:nth-child(even){background-color: #f2f2f2}\r\n/* This is the default state where full headers are visible */\r\n.full-header .short-header {\r\n    display: none;\r\n}\r\n\r\n/* Media query for mobile screens */\r\n@media screen and (max-width: 768px) {\r\n    .full-header .short-header {\r\n        display: inline-block; /* Show abbreviated headers */\r\n    }\r\n    .full-header {\r\n        display: none; /* Hide full headers */\r\n    }\r\n}",
    "template_md": "{% block content %}\r\n<style>\r\n@media print {\r\n   /* Ensure tables can break across pages */\r\n   table {\r\n      page-break-inside: auto;\r\n   }\r\n      .table-container {\r\n      display: block; /* Prevents forced side-by-side layout */\r\n   }\r\n   .table-half {\r\n      width: 100%; /* Makes both tables take full width when printed */\r\n   }\r\n   tr {\r\n      page-break-inside: avoid; /* Avoid breaking inside individual rows */\r\n      page-break-after: auto;\r\n   }\r\n   td, th {\r\n      page-break-inside: avoid; /* Ensures content inside cells doesn't split unexpectedly */\r\n   }\r\n   }\r\n   .header-container {\r\n   display: flex;\r\n   justify-content: space-between;\r\n   align-items: center;\r\n   padding-bottom: 10px;\r\n   border-bottom: 2px solid black;\r\n   margin-bottom: 10px;\r\n   }\r\n   .report-title {\r\n   text-align: right;\r\n   }\r\n   .section {\r\n   width: 100%;\r\n   padding-bottom: 20px;\r\n   }\r\n   .table-container {\r\n   display: flex;\r\n   align-items: flex-start; /* Ensures both tables start at the top */\r\n   justify-content: space-between;\r\n   gap: 10px;\r\n   }\r\n   .table-half {\r\n   width: 49%;\r\n   }\r\n   .progress-bar {\r\n    width: 100%;\r\n    height: 15px;\r\n    background-color: #e0e0e0;\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n   }\r\n   .progress-fill {\r\n      height: 100%;\r\n      border-radius: 8px;\r\n   }\r\n   table {\r\n   width: 100%;\r\n   border-collapse: collapse;\r\n   font-size: 11px;\r\n   }\r\n   th {\r\n      background-color: #004085; /* Dark Blue background */\r\n      color: #D4D4D4; /* Grey text */\r\n      border: 1px solid black;\r\n      padding: 5px;\r\n      text-align: left;\r\n   }\r\n   td {\r\n      border: 1px solid black;\r\n      padding: 5px;\r\n      text-align: left;\r\n   }\r\n   h2, h3, h4 {\r\n      margin-top: 10px;\r\n      margin-bottom: 5px;\r\n   }\r\n</style>\r\n<div class=\"header-container\">\r\n   <img src=\"https://github.com/amidaware/reporting-templates/blob/master/assets/gbtnavy%20(256).png?raw=true\" alt=\"Logo\" class=\"logo\">\r\n   <div class=\"report-title\">\r\n      <h1 class=\"text-2xl font-bold\">{{ client.name }}</h1>\r\n      <h2>Comprehensive System Health Report</h2>\r\n      <h2>Report Date: {{ report_run_timestamp.strftime('%Y-%m-%d') }}</h2>\r\n   </div>\r\n</div>\r\n{% for agent in data_sources.agentsList %}\r\n<div class=\"section page-break\">\r\n   <h2 class=\"text-lg font-bold\" style=\"display: flex; align-items: center;\">\r\n      {% if agent.plat == 'windows' %}\r\n         <img src=\"https://cdn.jsdelivr.net/npm/@mdi/svg@7.2.96/svg/microsoft-windows.svg\" \r\n               alt=\"Windows icon\" \r\n               style=\"width: 20px; height: 20px; margin-right: 5px;\" />\r\n      {% elif agent.plat == 'linux' %}\r\n         <img src=\"https://cdn.jsdelivr.net/npm/@mdi/svg@7.2.96/svg/linux.svg\" \r\n               alt=\"Linux icon\" \r\n               style=\"width: 20px; height: 20px; margin-right: 5px;\" />\r\n      {% elif agent.plat == 'darwin' %}\r\n         <img src=\"https://cdn.jsdelivr.net/npm/@mdi/svg@7.2.96/svg/apple.svg\" \r\n               alt=\"Apple icon\" \r\n               style=\"width: 20px; height: 20px; margin-right: 5px;\" />\r\n      {% endif %}\r\n      \r\n      {{ agent.hostname or 'N/A' }}\r\n   </h2>\r\n   <table>\r\n      <thead>\r\n         <tr>\r\n            <th>User</th>\r\n            <th>Location</th>\r\n            <th>RAM / CPU / Drive</th>\r\n            <th>Free Disk Space</th>\r\n            <th>OS Installed</th>\r\n            <th>Pending Patches</th>\r\n            <th>Needs Reboot</th>\r\n            <th>Local IP (public IP)</th>\r\n         </tr>\r\n      </thead>\r\n      <tbody>\r\n         <tr>\r\n            <td>{{ agent.last_logged_in_user or 'N/A' }}</td>\r\n            <td>{{ agent.site__name or 'N/A' }}</td>\r\n            <td>{{ agent.total_ram or 'N/A' }} GB / {{ agent.wmi_detail.cpu[0][0].Name if agent.wmi_detail and agent.wmi_detail.cpu else 'N/A' }} / {% for disk in agent.disks %}{{ disk.device }} ({{ disk.total }}){% if not loop.last %}, {% endif %}{% endfor %}</td>\r\n            <td>\r\n{% for disk in agent.disks %}\r\n    <div class=\"q-card-section\">\r\n        <span>{{ disk.device }} ({{ disk.fstype }})</span>\r\n\r\n        {% if disk.percent < 50 %}\r\n            {% set color = 'green' %}\r\n        {% elif disk.percent < 80 %}\r\n            {% set color = 'orange' %}\r\n        {% else %}\r\n            {% set color = 'red' %}\r\n        {% endif %}\r\n\r\n        <table style=\"width: 100%; border-collapse: collapse;\">\r\n            <tr>\r\n                {% for i in range(1, 101, 10) %}\r\n                    <td style=\"width: 10px; height: 15px;\r\n                        {% if i <= disk.percent %} background-color: {{ color }}; {% else %} background-color: #e0e0e0; {% endif %}\">\r\n                    </td>\r\n                {% endfor %}\r\n            </tr>\r\n        </table>\r\n\r\n        <span>{{ disk.free }} free of {{ disk.total }}</span>\r\n    </div>\r\n    {% endfor %}\r\n            </td>\r\n            <td>{{ agent.operating_system or 'N/A' }}</td>\r\n            <td>\r\n               {% set pending_patch_count = (data_sources.allFieldsWindowsUpdates | selectattr('agent__hostname', 'equalto', agent.hostname) | rejectattr('installed') | list | length) %}\r\n               {{ pending_patch_count }}\r\n            </td>\r\n            <td>\r\n               {% if agent.needs_reboot %}\r\n                  <span style=\"color:yellow; font-weight:bold;\">&#9888;</span> Yes\r\n               {% else %}\r\n                  No\r\n               {% endif %}\r\n            </td>\r\n            <td>{{ agent.wmi_detail | local_ips | join(', ') if agent.wmi_detail | local_ips else 'N/A'}}</td>\r\n         </tr>\r\n      </tbody>\r\n   </table>\r\n   <!-- Layout Improvement: Tasks & Checks Side by Side -->\r\n   <div class=\"table-container\">\r\n      <!-- Tasks Table -->\r\n      <div class=\"table-half\">\r\n         <h3 class=\"text-lg font-bold mt-4\">Tasks</h3>\r\n         <table>\r\n            <thead>\r\n               <tr>\r\n                  <th>Task Name</th>\r\n                  <th>Status</th>\r\n                  <th>Last Run</th>\r\n               </tr>\r\n            </thead>\r\n            <tbody>\r\n               {% for task in data_sources.allFieldsTaskResult if task.agent__hostname == agent.hostname %}\r\n               <tr>\r\n                  <td>{{ task.task__name or 'N/A' }}</td>\r\n                  <td>\r\n                     {% if task.retcode == 0 %}\r\n                     <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"green\">\r\n                        <path d=\"M9 16.2l-4.2-4.2-1.4 1.4 5.6 5.6 12-12-1.4-1.4z\"></path>\r\n                     </svg>\r\n                     Passing\r\n                     {% elif task.retcode == 1 %}\r\n                     <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"red\">\r\n                        <path d=\"M12 10.6l4.2-4.2 1.4 1.4-4.2 4.2 4.2 4.2-1.4 1.4-4.2-4.2-4.2 4.2-1.4-1.4 4.2-4.2-4.2-4.2 1.4-1.4z\"></path>\r\n                     </svg>\r\n                     Failing\r\n                     {% else %}\r\n                     <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"gray\">\r\n                        <path d=\"M12 2a10 10 0 1010 10A10 10 0 0012 2zm0 18a1.5 1.5 0 110-3 1.5 1.5 0 110 3zm1-5h-2V7h2z\"></path>\r\n                     </svg>\r\n                     Unknown\r\n                     {% endif %}\r\n                  </td>\r\n                  <td>{{ task.last_run.strftime('%Y-%m-%d') if task.last_run else 'N/A' }}</td>\r\n               </tr>\r\n               {% endfor %}\r\n            </tbody>\r\n         </table>\r\n      </div>\r\n      <!-- Checks Table -->\r\n      <div class=\"table-half\">\r\n         <h3 class=\"text-lg font-bold mt-4\">Checks</h3>\r\n         <table>\r\n            <thead>\r\n               <tr>\r\n                  <th>Check Name</th>\r\n                  <th>Status</th>\r\n                  <th>Last Run</th>\r\n               </tr>\r\n            </thead>\r\n            <tbody>\r\n               {% for check in data_sources.checkResults if check.agent__hostname == agent.hostname and check.assigned_check__script__name and check.assigned_check__script__name != 'Unnamed Check' %}\r\n               <tr>\r\n                  <td>{{ check.assigned_check__script__name }}</td>\r\n                  <td>\r\n                     {% if check.status == 'passing' %}\r\n                     <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"green\">\r\n                        <path d=\"M9 16.2l-4.2-4.2-1.4 1.4 5.6 5.6 12-12-1.4-1.4z\"></path>\r\n                     </svg>\r\n                     Passing\r\n                     {% else %}\r\n                     <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"red\">\r\n                        <path d=\"M12 10.6l4.2-4.2 1.4 1.4-4.2 4.2 4.2 4.2-1.4 1.4-4.2-4.2-4.2 4.2-1.4-1.4 4.2-4.2-4.2-4.2 1.4-1.4z\"></path>\r\n                     </svg>\r\n                     Failing\r\n                     {% endif %}\r\n                  </td>\r\n                  <td>{{ check.last_run.strftime('%Y-%m-%d') if check.last_run else 'N/A' }}</td>\r\n               </tr>\r\n               {% endfor %}\r\n            </tbody>\r\n         </table>\r\n      </div>\r\n   </div>\r\n   <!-- Newly Installed Software Table -->\r\n   <h3 class=\"text-md font-bold mt-4\">Newly Installed Software (Last 30 Days)</h3>\r\n   {% set software_found = [] %}\r\n   {% set cutoff_date = timedelta_30_days.strftime('%Y-%m-%d') %}\r\n   {% for software_data in data_sources.softwareList if software_data.agent__hostname == agent.hostname %}\r\n   {% for software in software_data.software %}\r\n   {% if software.install_date and software.install_date != \"01-1-01\" and software.install_date >= cutoff_date %}\r\n   {% set _ = software_found.append({\r\n   \"name\": software.name,\r\n   \"version\": software.version,\r\n   \"install_date\": software.install_date\r\n   }) %}\r\n   {% endif %}\r\n   {% endfor %}\r\n   {% endfor %}\r\n   <table>\r\n      <thead>\r\n         <tr>\r\n            <th>Software Name</th>\r\n            <th>Version</th>\r\n            <th>Installed Date</th>\r\n         </tr>\r\n      </thead>\r\n      <tbody>\r\n         {% for entry in software_found %}\r\n         <tr>\r\n            <td>{{ entry.name or 'N/A' }}</td>\r\n            <td>{{ entry.version or 'N/A' }}</td>\r\n            <td>{{ entry.install_date }}</td>\r\n         </tr>\r\n         {% endfor %}\r\n      </tbody>\r\n   </table>\r\n   <!-- Patch Management -->\r\n   <h3 class=\"text-lg font-bold mt-4\">Patch Management</h3>\r\n   <!-- Installed Patches (Last 30 Days) -->\r\n   <h4 class=\"text-md font-bold mt-2\">Installed Patches (Last 30 Days)</h4>\r\n   {% set installed_patches = [] %}\r\n   {% set cutoff_date = timedelta_30_days.strftime('%Y-%m-%d') %}\r\n   <table class=\"table-auto border-collapse border border-black w-full text-sm\">\r\n      <thead>\r\n         <tr>\r\n            <th class=\"border border-black px-2 py-1\">Patch Name</th>\r\n            <th class=\"border border-black px-2 py-1\">Severity</th>\r\n            <th class=\"border border-black px-2 py-1\">KB Article</th>\r\n            <th class=\"border border-black px-2 py-1\">Installed Date</th>\r\n         </tr>\r\n      </thead>\r\n      <tbody>\r\n         {% for patch in data_sources.allFieldsWindowsUpdates if patch.agent__hostname == agent.hostname and patch.installed %}\r\n         {% if patch.date_installed %}\r\n         {% set patch_date = patch.date_installed.strftime('%Y-%m-%d') %}\r\n         {% if patch_date >= cutoff_date %}\r\n         {% set _ = installed_patches.append({\r\n         \"title\": patch.title,\r\n         \"severity\": patch.severity,\r\n         \"kb_article_ids\": patch.kb_article_ids | join(', ') if patch.kb_article_ids else 'N/A',\r\n         \"date_installed\": patch_date\r\n         }) %}\r\n         {% endif %}\r\n         {% endif %}\r\n         {% endfor %}\r\n         {% if installed_patches %}\r\n         {% for patch in installed_patches %}\r\n         <tr>\r\n            <td class=\"border border-black px-2 py-1\">{{ patch.title or 'N/A' }}</td>\r\n            <td class=\"border border-black px-2 py-1\">{{ patch.severity or 'N/A' }}</td>\r\n            <td class=\"border border-black px-2 py-1\">{{ patch.kb_article_ids }}</td>\r\n            <td class=\"border border-black px-2 py-1\">\r\n               <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"green\">\r\n                  <path d=\"M9 16.2l-4.2-4.2-1.4 1.4 5.6 5.6 12-12-1.4-1.4z\"></path>\r\n               </svg>\r\n               Installed on {{ patch.date_installed }}\r\n            </td>\r\n         </tr>\r\n         {% endfor %}\r\n         {% else %}\r\n         <tr>\r\n            <td colspan=\"4\" class=\"border border-black px-2 py-1 text-center\">\r\n               No patches installed in the last 30 days\r\n            </td>\r\n         </tr>\r\n         {% endif %}\r\n      </tbody>\r\n   </table>\r\n   <!-- Pending Patches (Not Installed Yet) -->\r\n   <h4 class=\"text-md font-bold mt-2\">Pending Patches (Not Installed Yet)</h4>\r\n   <table class=\"table-auto border-collapse border border-black w-full text-sm\">\r\n      <thead>\r\n         <tr>\r\n            <th class=\"border border-black px-2 py-1\">Patch Name</th>\r\n            <th class=\"border border-black px-2 py-1\">Severity</th>\r\n            <th class=\"border border-black px-2 py-1\">KB Article</th>\r\n            <th class=\"border border-black px-2 py-1\">Status</th>\r\n         </tr>\r\n      </thead>\r\n      <tbody>\r\n         {% set pending_patches = [] %}\r\n         {% for patch in data_sources.allFieldsWindowsUpdates if patch.agent__hostname == agent.hostname and not patch.installed %}\r\n         {% set _ = pending_patches.append(patch) %}\r\n         {% endfor %}\r\n         {% if pending_patches %}\r\n         {% for patch in pending_patches %}\r\n         <tr>\r\n            <td class=\"border border-black px-2 py-1\">{{ patch.title or 'N/A' }}</td>\r\n            <td class=\"border border-black px-2 py-1\">{{ patch.severity or 'N/A' }}</td>\r\n            <td class=\"border border-black px-2 py-1\">{{ patch.kb_article_ids | join(', ') if patch.kb_article_ids else 'N/A' }}</td>\r\n            <td class=\"border border-black px-2 py-1\">\r\n               <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"red\">\r\n                  <path d=\"M12 10.6l4.2-4.2 1.4 1.4-4.2 4.2 4.2 4.2-1.4 1.4-4.2-4.2-4.2 4.2-1.4-1.4 4.2-4.2-4.2-4.2 1.4-1.4z\"></path>\r\n               </svg>\r\n               Not Installed\r\n            </td>\r\n         </tr>\r\n         {% endfor %}\r\n         {% else %}\r\n         <tr>\r\n            <td colspan=\"4\" class=\"border border-black px-2 py-1 text-center\">All patches installed</td>\r\n         </tr>\r\n         {% endif %}\r\n      </tbody>\r\n   </table>\r\n</div>\r\n{% endfor %}\r\n{% endblock %}",
    "type": "html",
    "depends_on": [
      "client"
    ],
    "template_variables": "report_run_timestamp: !now\ntimedelta_30_days: !now days=-30\n\ndata_sources:\n  agentsList:\n    filter:\n      site__client_id: \"{{client.id}}\"\n    model: agent\n    only:\n      - hostname\n      - operating_system\n      - site__name\n      - site__client__name\n      - last_logged_in_user\n      - wmi_detail\n      - total_ram\n      - needs_reboot\n      - disks\n      - plat\n  allFieldsTaskResult:\n    model: taskresult\n    filter:\n      agent__site__client__id: \"{{ client.id }}\"\n    order_by:\n      - agent__site__client__name\n      - agent__site__name\n      - agent__hostname\n      - task__name\n    only:\n      - id\n      - agent__site__client__name\n      - agent__site__name\n      - task__name\n      - agent__hostname\n      - retcode\n      - last_run\n  checkResults:\n    model: checkresult\n    select_related:\n      - agent__site\n      - agent__site__client\n    only:\n      - agent__hostname\n      - assigned_check__script__name\n      - status\n      - last_run\n  softwareList:\n    model: installedsoftware\n    filter:\n      agent__site__client__id: \"{{ client.id }}\"\n    only:\n      - agent__hostname\n      - software\n  allFieldsWindowsUpdates:\n    filter:\n      agent__site__client__id: \"{{client.id}}\"\n    model: winupdate\n    only:\n      - id\n      - agent__hostname\n      - title\n      - installed\n      - description\n      - severity\n      - categories\n      - category_ids\n      - kb_article_ids\n      - date_installed"
  },
  "assets": []
}
